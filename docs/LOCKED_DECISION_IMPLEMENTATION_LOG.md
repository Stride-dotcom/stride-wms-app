# Locked Decision Implementation Log (Append-Only)

Last updated: 2026-02-14

## Rules

1. Append new rows only. Do not rewrite prior rows.
2. Use this log to track implementation progress, evidence, blockers, and verification.
3. This log may reference locked decisions without editing their decision body.

## Event types

- `planned`
- `in_progress`
- `completed`
- `verified`
- `blocked`

## Log

| Event ID | Date | Decision ID | Event Type | Evidence | Actor | Notes |
|---|---|---|---|---|---|---|
| DLE-2026-02-14-001 | 2026-02-14 | DL-2026-02-14-002 | completed | Added `docs/LOCKED_DECISION_LEDGER.md` | builder | Established docs-only governance direction. |
| DLE-2026-02-14-002 | 2026-02-14 | DL-2026-02-14-003 | completed | Added ledger lock model and lifecycle states | builder | Editable until lock; immutable after lock. |
| DLE-2026-02-14-003 | 2026-02-14 | DL-2026-02-14-004 | completed | Added supersession protocol in ledger | builder | Changes after lock use new decision entries. |
| DLE-2026-02-14-004 | 2026-02-14 | DL-2026-02-14-005..DL-2026-02-14-050 | completed | Added `docs/LOCKED_DECISION_LEDGER_PHASE5V3_IMPORT.md` | builder | Imported full detailed locked decision set from authoritative Phase 5 v3 PDF. |
| DLE-2026-02-14-005 | 2026-02-14 | DL-2026-02-14-005..DL-2026-02-14-050 | completed | Expanded index in `docs/LOCKED_DECISION_LEDGER.md` | builder | Registered all imported decisions in canonical ledger index. |
| DLE-2026-02-14-006 | 2026-02-14 | DL-2026-02-14-051 | planned | Updated `docs/LOCKED_DECISION_LEDGER.md` with accepted superseding decision | builder | Shifted direction from route-level gating toward app-level restriction + payment-update redirect. |
| DLE-2026-02-14-007 | 2026-02-14 | DL-2026-02-14-052 | planned | Updated `docs/LOCKED_DECISION_LEDGER.md` with accepted timing decision | builder | Redirect trigger now starts at `past_due` (during grace). |
| DLE-2026-02-14-008 | 2026-02-14 | DL-2026-02-14-053 | planned | Updated `docs/LOCKED_DECISION_LEDGER.md` with accepted UX polling decision | builder | Blocked flow will auto-check recovery and include manual refresh. |
| DLE-2026-02-14-009 | 2026-02-14 | DL-2026-02-14-054 | planned | Updated `docs/LOCKED_DECISION_LEDGER.md` with accepted route decision | builder | Standardized blocked destination as `/subscription/update-payment`. |
| DLE-2026-02-14-010 | 2026-02-14 | DL-2026-02-14-055 | planned | Updated `docs/LOCKED_DECISION_LEDGER.md` with accepted ops-page decision | builder | Added dev-only Stripe observability page direction; no credential editing in app. |
| DLE-2026-02-14-011 | 2026-02-14 | DL-2026-02-14-056 | planned | Updated `docs/LOCKED_DECISION_LEDGER.md` with accepted allowlist decision | builder | Blocked-state allowlist includes auth, payment update, logout, and help/support. |
| DLE-2026-02-14-012 | 2026-02-14 | DL-2026-02-14-057 | planned | Updated `docs/LOCKED_DECISION_LEDGER.md` with accepted RPC identity decision | builder | Standardized payment mutation identity on `stripe_subscription_id`. |
| DLE-2026-02-14-013 | 2026-02-14 | DL-2026-02-14-058 | planned | Updated `docs/LOCKED_DECISION_LEDGER.md` with accepted webhook lookup decision | builder | `subscription.updated` tenant resolution now uses customer-id fallback to subscription-id. |
| DLE-2026-02-14-014 | 2026-02-14 | DL-2026-02-14-059 | planned | Updated `docs/LOCKED_DECISION_LEDGER.md` with accepted portal-launch decision | builder | Payment update route will auto-open Stripe Customer Portal on load. |
| DLE-2026-02-14-015 | 2026-02-14 | DL-2026-02-14-060 | planned | Updated `docs/LOCKED_DECISION_LEDGER.md` with accepted shared-route decision | builder | Client and internal users share the same blocked destination route. |
| DLE-2026-02-14-016 | 2026-02-14 | DL-2026-02-14-061 | planned | Updated `docs/LOCKED_DECISION_LEDGER.md` with accepted Stripe-hosted payment-entry decision | builder | Payment details remain in Stripe-hosted pages; app avoids raw card data handling. |
| DLE-2026-02-14-017 | 2026-02-14 | DL-2026-02-14-062 | planned | Updated `docs/LOCKED_DECISION_LEDGER.md` with accepted support-channel decision | builder | Blocked-flow support uses external mailto contact with tenant email preference. |
| DLE-2026-02-14-018 | 2026-02-14 | DL-2026-02-14-051..DL-2026-02-14-054,DL-2026-02-14-056,DL-2026-02-14-060,DL-2026-02-14-062 | completed | Commit `28b25dc` (`src/components/ProtectedRoute.tsx`, `src/App.tsx`, `src/pages/SubscriptionUpdatePayment.tsx`) | builder | Implemented full-app blocked redirect flow, payment-update route, polling/manual refresh, shared client/internal destination, and support contact UX. |
| DLE-2026-02-14-019 | 2026-02-14 | DL-2026-02-14-057,DL-2026-02-14-058,DL-2026-02-14-059,DL-2026-02-14-061 | completed | Commit `28b25dc` (`supabase/functions/stripe-webhook/index.ts`, `supabase/functions/create-stripe-portal-session/*`) | builder | Standardized subscription-id mutation identity, customer-first fallback lookup for subscription updates/deletes, auto-launch Stripe portal path, and Stripe-hosted payment boundary. |
| DLE-2026-02-14-020 | 2026-02-14 | DL-2026-02-14-055 | completed | Commits `28b25dc`, `3f2b622` (`src/pages/admin/StripeOps.tsx`, `src/App.tsx`) | builder | Added minimal `admin_dev` Stripe Ops observability page and route with dashboard deep links and status snapshot. |
| DLE-2026-02-14-021 | 2026-02-14 | DL-2026-02-14-054,DL-2026-02-14-055,DL-2026-02-14-062 | completed | Commit `c4d5c66` (`src/pages/admin/StripeOps.tsx`, `src/pages/SubscriptionUpdatePayment.tsx`) | builder | Aligned new subscription/ops pages to existing app UI patterns (DashboardLayout + PageHeader for admin page, consistent card/button/typography behavior, tenant-scoped support contact flow). |
| DLE-2026-02-14-022 | 2026-02-14 | DL-2026-02-14-063 | completed | Updated `docs/LOCKED_DECISION_LEDGER.md` with accepted governance decision | builder | Kept DL-051..DL-062 in accepted state pending post-deploy Stripe CLI validation. |
| DLE-2026-02-14-023 | 2026-02-14 | DL-2026-02-14-051..DL-2026-02-14-062 | planned | Added `docs/PHASE5_STRIPE_CLI_VALIDATION_CHECKLIST.md` | builder | Prepared executable Stripe CLI validation runbook to gather verification evidence before locking decisions. |
| DLE-2026-02-14-024 | 2026-02-14 | DL-2026-02-14-063 | completed | Added `docs/PHASE5_DEPLOYMENT_COMMAND_SCRIPT.md` | builder | Prepared copy/paste deployment command order for schema, function deploy, secrets, Stripe CLI forwarding, validation, and post-verify locking steps. |
| DLE-2026-02-14-025 | 2026-02-14 | DL-2026-02-14-063 | completed | Added `scripts/phase5_validate.sh` and linked docs | builder | Added non-interactive helper script for db push, function deploy, and secret updates with dry-run support. |
| DLE-2026-02-14-026 | 2026-02-14 | DL-2026-02-14-063 | completed | Commit `f65af67` (`scripts/phase5_validate.sh`) | builder | Corrected helper behavior so dry-run mode works without local Supabase CLI installation. |
| DLE-2026-02-14-027 | 2026-02-14 | DL-2026-02-14-013,DL-2026-02-14-014 | planned | Updated `docs/PHASE5_SAAS_CONTINUATION_QA_PLAN.md` | builder | Explicitly tracked outstanding Phase 5.1 checkout session creator dependency (`metadata.tenant_id` source). |
| DLE-2026-02-14-028 | 2026-02-14 | DL-2026-02-14-064,DL-2026-02-14-013,DL-2026-02-14-014 | completed | Added `create-stripe-checkout-session` edge function and Billing trigger wiring | builder | Implemented Phase 5.1 checkout session creator with `metadata.tenant_id` and Billing page Start/Manage subscription trigger. |
| DLE-2026-02-14-029 | 2026-02-14 | DL-2026-02-14-064,DL-2026-02-14-013,DL-2026-02-14-014 | completed | Commit `1d8ad62` (`supabase/functions/create-stripe-checkout-session/*`, `src/pages/Billing.tsx`) | builder | Added Phase 5.1 session creator and dynamic Start/Manage subscription trigger path from Billing page. |
| DLE-2026-02-14-030 | 2026-02-14 | DL-2026-02-14-063 | verified | `npx tsc --noEmit`, `npm run build`, script dry-run output (post commit `1d8ad62`) | builder | Local static verification passed; runtime validation remains blocked on environment deploy + Stripe CLI event execution. |
| DLE-2026-02-14-031 | 2026-02-14 | DL-2026-02-14-065 | planned | Updated `docs/LOCKED_DECISION_LEDGER.md` with accepted pricing-model decision | builder | Tracked single base plan + optional SMS add-on direction for compatibility with parallel automation work. |
| DLE-2026-02-14-032 | 2026-02-14 | DL-2026-02-14-066,DL-2026-02-14-067 | planned | Updated `docs/LOCKED_DECISION_LEDGER.md` with accepted post-checkout SMS and billing-visibility decisions | builder | Captured Settings-based SMS activation/terms flow and Billing summary visibility as next implementation scope. |
| DLE-2026-02-14-033 | 2026-02-14 | DL-2026-02-14-068 | completed | Added `supabase/migrations/20260215013000_saas_sms_addon_activation.sql`, `src/hooks/useSmsAddonActivation.ts` | builder | Implemented tenant-level SMS terms acceptance audit schema and activation RPC capturing version/time/user/ip/user-agent/source. |
| DLE-2026-02-14-034 | 2026-02-14 | DL-2026-02-14-066,DL-2026-02-14-067 | completed | Added `src/components/settings/SmsAddonActivationCard.tsx`; updated `OrganizationSettingsTab.tsx` and `src/pages/Billing.tsx` | builder | Added Settings SMS activation card with readiness + terms confirmation and Billing subscription summary including SMS add-on state. |
| DLE-2026-02-14-035 | 2026-02-14 | DL-2026-02-14-066,DL-2026-02-14-067,DL-2026-02-14-068 | verified | `npx tsc --noEmit`, `npm run build` (post commit `73d378c`) | builder | Local static validation passed for SMS activation schema/RPC and Settings/Billing UX updates. |
| DLE-2026-02-14-036 | 2026-02-14 | DL-2026-02-14-069 | completed | Added `supabase/migrations/20260215015500_sms_addon_self_deactivation.sql` | builder | Added tenant-admin self-deactivation RPC with deactivation audit event and automatic `sms_enabled=false` safety update. |
| DLE-2026-02-14-037 | 2026-02-14 | DL-2026-02-14-069,DL-2026-02-14-067 | completed | Updated `src/hooks/useSmsAddonActivation.ts`, `src/components/settings/SmsAddonActivationCard.tsx`, `src/pages/Billing.tsx` | builder | Added self-deactivate action in Settings (with confirmation) and surfaced `disabled` SMS add-on status in Billing summary. |
| DLE-2026-02-14-038 | 2026-02-14 | DL-2026-02-14-069 | verified | `npx tsc --noEmit`, `npm run build` (post commit `81e21ed`) | builder | Local static verification passed for self-deactivation RPC + Settings/Billing self-service UX updates. |
| DLE-2026-02-14-039 | 2026-02-14 | DL-2026-02-14-070 | completed | Updated `docs/LOCKED_DECISION_LEDGER.md` and `docs/PHASE5_SAAS_CONTINUATION_QA_PLAN.md` | builder | Captured accepted decision that deactivated SMS history remains visible as read-only in tenant-facing billing/report views. |
| DLE-2026-02-14-040 | 2026-02-14 | DL-2026-02-14-070 | completed | Updated `src/pages/Billing.tsx` summary messaging | builder | Added explicit Billing UI note that disabled SMS status retains read-only historical billing/report visibility. |
| DLE-2026-02-14-041 | 2026-02-14 | DL-2026-02-14-070 | verified | `npx tsc --noEmit`, `npm run build` (post commit `e6bc478`) | builder | Local static verification passed for read-only history decision capture and Billing read-only visibility messaging update. |
| DLE-2026-02-14-042 | 2026-02-14 | DL-2026-02-14-071 | completed | Added `docs/LOCKED_DECISION_QA_LOG_2026-02-14.md` and linked source in ledger | builder | Established append-only Q&A traceability for SMS/Twilio/billing planning decisions. |
| DLE-2026-02-14-043 | 2026-02-14 | DL-2026-02-14-072..DL-2026-02-14-086 | planned | Updated `docs/LOCKED_DECISION_LEDGER.md` with accepted platform/SMS/billing decisions from Q&A | builder | Build-out scope recorded for automated provisioning, Stripe billing automation, pricing console, and tenant billing UX targeting. |
| DLE-2026-02-14-044 | 2026-02-14 | DL-2026-02-14-087 | planned | Q&A confirmation: "Multi" (`docs/LOCKED_DECISION_QA_LOG_2026-02-14.md`) | builder | Resolved comped override scope to multi-tenant and recorded as accepted policy. |
| DLE-2026-02-14-045 | 2026-02-14 | DL-2026-02-14-088 | blocked | Q&A indicates unresolved first-month proration policy | builder | Keep decision in draft until owner confirms prorated vs full first-cycle monthly fee. |
| DLE-2026-02-14-046 | 2026-02-14 | DL-2026-02-14-072,DL-2026-02-14-073,DL-2026-02-14-074,DL-2026-02-14-075,DL-2026-02-14-076 | completed | Added `supabase/migrations/20260215030000_platform_managed_sms_sender.sql` | builder | Added platform-managed sender lifecycle schema and RPCs for tenant request flow + admin status updates with approval-gated `sms_enabled` and billing start marker. |
| DLE-2026-02-14-047 | 2026-02-14 | DL-2026-02-14-072,DL-2026-02-14-073,DL-2026-02-14-075,DL-2026-02-14-086 | completed | Added `src/hooks/useSmsSenderProvisioning.ts`; updated `src/components/settings/SmsAddonActivationCard.tsx` and `src/components/settings/OrganizationSettingsTab.tsx` | builder | Removed tenant Twilio setup card from Organization settings, switched activation checklist to platform-managed provisioning, and added toll-free request UX with status visibility. |
| DLE-2026-02-14-048 | 2026-02-14 | DL-2026-02-14-083 | completed | Updated `src/pages/Billing.tsx` | builder | Extended subscription summary with sender provisioning status, assigned number, and SMS billing start visibility for tenant billing UX. |
| DLE-2026-02-14-049 | 2026-02-14 | DL-2026-02-14-084 | completed | Updated `supabase/functions/sms-opt-in/index.ts` and `src/pages/SmsOptIn.tsx` | builder | Implemented subdomain-based tenant resolution for public SMS opt-in when tenant ID is omitted from URL. |
| DLE-2026-02-14-050 | 2026-02-14 | DL-2026-02-14-077,DL-2026-02-14-082 | completed | Added `supabase/migrations/20260215043000_saas_pricing_console_and_subscription_invoices.sql` | builder | Added effective-dated global pricing versions, pricing notice dispatch audit log, and effective pricing resolver RPC. |
| DLE-2026-02-14-051 | 2026-02-14 | DL-2026-02-14-078,DL-2026-02-14-082 | completed | Added `supabase/functions/send-pricing-update-notices/index.ts` | builder | Added admin-dev bulk email notice dispatch to subscriber `company_email` recipients with per-send audit logging. |
| DLE-2026-02-14-052 | 2026-02-14 | DL-2026-02-14-082 | completed | Added `src/hooks/useSaasPricingAdmin.ts`, `src/pages/admin/PricingOps.tsx`; updated `src/App.tsx`, `src/pages/admin/StripeOps.tsx` | builder | Implemented admin-dev pricing console for app monthly + SMS monthly + per-segment rates, scheduling, and one-click upcoming/effective-today notice sends. |
| DLE-2026-02-14-053 | 2026-02-14 | DL-2026-02-14-083,DL-2026-02-14-081 | completed | Updated `supabase/functions/stripe-webhook/index.ts` and `src/pages/Billing.tsx` | builder | Added Stripe invoice snapshot upserts and surfaced tenant SaaS subscription invoices in Billing with hosted/PDF links. |
| DLE-2026-02-14-054 | 2026-02-14 | DL-2026-02-14-073,DL-2026-02-14-074,DL-2026-02-14-075,DL-2026-02-14-076 | completed | Added `supabase/migrations/20260215060000_admin_sms_sender_ops_views.sql` | builder | Added admin-dev sender ops listing/history RPCs and admin_dev read policies for sender profile tables. |
| DLE-2026-02-14-055 | 2026-02-14 | DL-2026-02-14-073,DL-2026-02-14-074,DL-2026-02-14-075,DL-2026-02-14-076 | completed | Added `src/hooks/useSmsSenderOpsAdmin.ts`, `src/pages/admin/SmsSenderOps.tsx`; updated `src/App.tsx`, `src/pages/admin/StripeOps.tsx`, `src/pages/admin/PricingOps.tsx` | builder | Implemented admin-dev SMS Sender Ops UI with queue filtering, status transitions, number assignment fields, and tenant event history viewer. |
| DLE-2026-02-14-056 | 2026-02-14 | DL-2026-02-14-089 | completed | Updated `docs/LOCKED_DECISION_LEDGER.md`, `docs/PHASE5_SAAS_CONTINUATION_QA_PLAN.md`, `src/components/settings/SmsAddonActivationCard.tsx` | builder | Captured accepted re-acceptance policy and clarified in Settings UI that terms must be re-accepted for each reactivation. |
| DLE-2026-02-14-057 | 2026-02-14 | DL-2026-02-14-089 | verified | `npx tsc --noEmit`, `npm run build` (post commit `78d48a1`) | builder | Local static verification passed after documenting and surfacing reactivation terms re-acceptance requirement. |
| DLE-2026-02-14-058 | 2026-02-14 | DL-2026-02-14-090 | completed | Updated `docs/LOCKED_DECISION_LEDGER.md`, `docs/PHASE5_SAAS_CONTINUATION_QA_PLAN.md` | builder | Captured explicit reminder that configurable SMS terms-version control is deferred to Phase 6 while keeping current value fixed at `sms-addon-v1`. |
| DLE-2026-02-14-059 | 2026-02-14 | DL-2026-02-14-063 | blocked | `npx supabase functions deploy ...` in cloud runtime | builder | Deployment execution blocked in this runtime because `SUPABASE_ACCESS_TOKEN` is not available for Supabase management API authentication. |
| DLE-2026-02-14-060 | 2026-02-14 | DL-2026-02-14-063 | completed | Updated `scripts/phase5_validate.sh`, `docs/PHASE5_DEPLOYMENT_COMMAND_SCRIPT.md` | builder | Hardened deploy helper for current CLI behavior: supports npx fallback, project link + db push flow, and optional DB password for non-interactive migration push. |
| DLE-2026-02-14-061 | 2026-02-14 | DL-2026-02-14-063 | verified | `bash scripts/phase5_validate.sh --project-ref l... --skip-secrets --dry-run` | builder | Verified updated helper emits correct modern CLI command sequence (link -> db push -> function deploy), using npx fallback in this runtime. |
| DLE-2026-02-14-062 | 2026-02-14 | DL-2026-02-14-068,DL-2026-02-14-069 | completed | Added `supabase/migrations/20260215022000_sms_addon_deactivate_active_guard.sql` | builder | Patched `rpc_deactivate_sms_addon` with active-state guard so already-inactive requests do not mutate evidence fields or append duplicate `deactivated` audit events. |
| DLE-2026-02-14-063 | 2026-02-14 | DL-2026-02-14-068,DL-2026-02-14-069 | verified | `npx tsc --noEmit`, `npm run build` (post commit `ca2f1da`) | builder | Static validation passed after deactivation guard patch; no frontend regressions detected from migration-only function update. |
| DLE-2026-02-14-064 | 2026-02-14 | DL-2026-02-14-066,DL-2026-02-14-068 | completed | Added `supabase/migrations/20260215023000_sms_addon_activation_readiness_guard.sql` | builder | Added server-side activation readiness guard so direct RPC calls cannot bypass required SMS onboarding fields (sender, legal URLs, compliance copy, use-case/sample, sms_enabled). |
| DLE-2026-02-14-065 | 2026-02-14 | DL-2026-02-14-066,DL-2026-02-14-068 | verified | `npx tsc --noEmit`, `npm run build` (post commit `0fd5e83`) | builder | Static validation passed after activation readiness guard patch; migration-only function update introduced no frontend/type regressions. |

## Event template (copy/paste)

```md
| <Event ID> | <YYYY-MM-DD> | <Decision ID> | <planned|in_progress|completed|verified|blocked> | <commit/PR/file/test link> | <actor> | <note> |
```

