# Stride WMS - Developer Reference

## Project Overview

Stride WMS is a warehouse management system built with:
- React 18 + TypeScript
- Supabase (PostgreSQL + Auth)
- shadcn/ui components
- Tailwind CSS
- react-router-dom for routing
- MaterialIcon component for icons

## Key Patterns

### File Organization
- Hooks in `src/hooks/` for data fetching and state management
- Components organized by feature in `src/components/`
- Pages in `src/pages/`
- Supabase client in `src/integrations/supabase/client.ts`

### Common Patterns
- Toast notifications via `useToast` hook
- Auth context via `useAuth` hook
- Multi-tenant architecture with `tenant_id` on all tables
- `(supabase.from('table') as any)` pattern for TypeScript flexibility

## Invoice Builder Feature

The Invoice Builder allows creating invoices from billing events with flexible grouping options.

### Key Files
- `src/components/invoices/InvoiceBuilderTab.tsx` - Main builder interface
- `src/components/invoices/SavedInvoicesTab.tsx` - Invoice management
- `src/components/invoices/InvoiceGroupingSelector.tsx` - Grouping options
- `src/hooks/useInvoiceBuilder.ts` - Builder state management
- `src/lib/invoiceBuilder/types.ts` - TypeScript interfaces

### User Flow
1. Billing Report → Select unbilled events → Click "Create Invoice"
2. Invoice Builder → Choose grouping → Preview → Create
3. Saved Invoices → View, Email, Download, Mark Paid, Void

### Invoice Numbering
- Global sequential: INV-00001, INV-00002, etc.
- Generated by `next_global_invoice_number()` PostgreSQL function

### Payment Tracking
- Configured in org settings: 'simple' or 'full'
- Simple: Draft → Sent → Void
- Full: Draft → Sent → Paid → Void (with partial payment support)

### Database Tables
- `invoices` - Invoice headers with batch_id for grouped creation
- `invoice_lines` - Line items linked to billing_events
- `billing_events` - Source charges (status updated to 'invoiced' after creation)

## Billing System

### Event Types
- `receiving` - Charges for receiving items
- `storage` - Daily storage charges
- `shipping` - Outbound shipment charges
- `addon` - Manual/custom charges
- `service` - Service-based charges

### Billing Event Status
- `unbilled` - Not yet invoiced
- `invoiced` - Linked to an invoice
- `void` - Cancelled/reversed

## Common Components

### MaterialIcon
```tsx
<MaterialIcon name="icon_name" size="sm" className="..." />
```
Sizes: sm, md, lg, xl

### Toast
```tsx
const { toast } = useToast();
toast({ title: "Success", description: "..." });
toast({ title: "Error", variant: "destructive" });
```

## Database Conventions

- All tables have `tenant_id` for multi-tenancy
- Soft deletes via `deleted_at` timestamp
- Created/updated tracking via `created_at`, `updated_at`
- Foreign keys use `_id` suffix (e.g., `account_id`)
